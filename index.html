<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Application | Key Legacy Realty</title>
    <link rel="stylesheet" href="css/te-style.css">
    <style>
        .form-section {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .form-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <div class="brand">
                Key Legacy Realty
                <span class="sub">Philadelphia Rentals</span>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <label
                    style="display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 700; color: var(--accent-color); cursor: pointer;">
                    <input type="checkbox" id="devModeToggle" onchange="toggleDevMode()">
                    DEV MODE
                </label>
            </div>
        </header>

        <div class="split-layout">
            <!-- Left Sidebar: Context -->
            <div class="sidebar" style="padding: 0; display: flex; flex-direction: column;">
                <nav style="flex: 1;">
                    <button class="nav-item active" onclick="switchSection(1)" data-section="1">
                        <div class="step-number">1</div>
                        <div class="nav-title">Contact Information</div>
                    </button>
                    <button class="nav-item disabled" onclick="switchSection(2)" data-section="2">
                        <div class="step-number">2</div>
                        <div class="nav-title">Property Preferences</div>
                    </button>
                    <button class="nav-item disabled" onclick="switchSection(3)" data-section="3">
                        <div class="step-number">3</div>
                        <div class="nav-title">Financial Information</div>
                    </button>
                    <button class="nav-item disabled" onclick="switchSection(4)" data-section="4">
                        <div class="step-number">4</div>
                        <div class="nav-title">Scheduling &amp; Notes</div>
                    </button>
                </nav>
            </div>

            <!-- Right Panel: Form -->
            <div class="form-panel">
                <form id="fullApplicationForm" onsubmit="handleFinalSubmit(event)">

                    <!-- SECTION 1: IDENTITY -->
                    <div id="section-1" class="form-section active">
                        <div style="margin-bottom: 30px;">
                            <span class="badge">STEP 01 OF 04</span>
                            <h2 style="margin-top: 10px; font-size: 24px;">Contact Information</h2>
                        </div>

                        <!-- Consent Block -->
                        <div
                            style="padding: 20px; background: rgba(0,0,0,0.03); border: 1px solid var(--border-color); margin-bottom: 20px;">
                            <label class="input-label" style="margin-bottom: 10px; display: block;">Consent</label>
                            <p
                                style="font-size: 12px; color: var(--muted-color); margin-bottom: 15px; line-height: 1.6;">
                                By continuing, I confirm that the information provided is accurate, that I've read and
                                received the
                                <a href="assets/pdf/Consumer%20Notice.pdf" target="_blank"
                                    style="color: var(--accent-color); font-weight: 700; text-decoration: underline; padding: 2px 4px; margin: -2px -4px;">Consumer
                                    Notice</a> and
                                <a href="assets/pdf/KLR%20Application%20Criteria%20%5B12.1.2025%5D.pdf" target="_blank"
                                    style="color: var(--accent-color); font-weight: 700; text-decoration: underline; padding: 2px 4px; margin: -2px -4px;">Application
                                    Criteria</a>, and that Key Legacy Realty may use this information to schedule tours.
                            </p>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="consentSection1" required>
                                <span style="font-size: 13px;">I agree</span>
                            </label>
                        </div>

                        <div class="input-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="agent" id="agentCheckbox" value="no" required>
                                <span class="input-label" style="margin: 0;">I do not have a real estate agent</span>
                            </label>
                        </div>

                        <div class="floating-label-group">
                            <input type="text" name="firstName" id="firstName" placeholder=" " required>
                            <label for="firstName">First Name</label>
                        </div>

                        <div class="floating-label-group">
                            <input type="text" name="lastName" id="lastName" placeholder=" " required>
                            <label for="lastName">Last Name</label>
                        </div>

                        <div class="floating-label-group">
                            <input type="tel" name="phone" id="phone" placeholder=" " required>
                            <label for="phone">Phone Number</label>
                        </div>

                        <div class="floating-label-group">
                            <input type="email" name="email" id="email" placeholder=" " required>
                            <label for="email">Email Address</label>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Preferred Contact Method</label>
                            <div class="button-group">
                                <input type="hidden" name="preferredContact" id="input-contact" required>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-contact', 'email')">Email</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-contact', 'text')">Text Message</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-contact', 'phone')">Phone Call</button>
                            </div>
                        </div>

                        <button type="button" class="btn-submit" onclick="nextSection()">Continue</button>
                    </div>

                    <!-- SECTION 2: PROPERTY REQUIREMENTS -->
                    <div id="section-2" class="form-section">
                        <div style="margin-bottom: 30px;">
                            <span class="badge">STEP 02 OF 04</span>
                            <h2 style="margin-top: 10px; font-size: 24px;">Property Preferences</h2>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Property Type</label>
                            <div class="button-group preference-grid">
                                <input type="hidden" name="propertyInterest" id="input-propertyInterest" required>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-propertyInterest', 'Apartment')">Apartment</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-propertyInterest', 'House')">House</button>
                            </div>
                        </div>

                        <!-- Button Group: Bedrooms -->
                        <div class="input-group">
                            <label class="input-label">Bedrooms</label>
                            <div class="button-group preference-grid" id="bedroom-group">
                                <!-- JS will populate hidden input -->
                                <input type="hidden" name="bedrooms" id="input-bedrooms" required>

                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-bedrooms', 'Studio')">Studio</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-bedrooms', '1 Bedroom')">1 Bedroom</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-bedrooms', '2 Bedroom')">2 Bedroom</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-bedrooms', '3 Bedroom')">3 Bedroom</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-bedrooms', '4 Bedroom')">4 Bedroom</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-bedrooms', '5+ Bedrooms')">5+ Bedrooms</button>
                            </div>
                        </div>

                        <!-- Button Group: Neighborhoods -->
                        <div class="input-group">
                            <label class="input-label">Preferred Neighborhoods</label>
                            <div class="button-group preference-grid">
                                <input type="hidden" name="neighborhoods" id="input-neighborhoods" required>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Center City')">Center
                                    City</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Rittenhouse Square')">Rittenhouse
                                    Square</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Old City / Society Hill')">Old
                                    City / Society Hill</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'University City')">University
                                    City</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Northern Liberties / Fishtown')">Northern
                                    Liberties / Fishtown</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Fairmount / Art Museum')">Fairmount
                                    / Art Museum</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'South Philly')">South
                                    Philly</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'East Passyunk')">East
                                    Passyunk</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Manayunk / Roxborough')">Manayunk
                                    / Roxborough</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Chestnut Hill')">Chestnut
                                    Hill</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Mt. Airy')">Mt. Airy</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Northeast Philly')">Northeast
                                    Philly</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'North Philly')">North
                                    Philly</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-neighborhoods', 'Southwest Philly')">Southwest
                                    Philly</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Move-In Date</label>
                            <input type="date" name="moveInDate" required>
                        </div>

                        <!-- Button Group: Budget -->
                        <div class="input-group">
                            <label class="input-label">Monthly Budget</label>

                            <div class="button-group preference-grid">
                                <input type="hidden" name="budget" id="input-budget" required>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-budget', '$1,000-$1,200')">$1,000-$1,200</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-budget', '$1,200-$1,500')">$1,200-$1,500</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-budget', '$1,500-$1,800')">$1,500-$1,800</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-budget', '$1,800-$2,200')">$1,800-$2,200</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-budget', '$2,200+')">$2,200+</button>
                            </div>
                        </div>

                        <!-- Button Group: Must-Haves -->
                        <div class="input-group">
                            <label class="input-label">Must-Have Features</label>

                            <div class="button-group preference-grid">
                                <input type="hidden" name="nonNegotiables" id="input-negotiables" required>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Parking')">Parking</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'In-Unit Laundry')">In-Unit
                                    Laundry</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Central Air')">Central
                                    Air</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Dishwasher')">Dishwasher</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Outdoor Space')">Outdoor
                                    Space</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Gym Access')">Gym Access</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Storage')">Storage</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Utilities Included')">Utilities
                                    Included</button>
                                <button type="button" class="option-btn"
                                    onclick="toggleOption(this, 'input-negotiables', 'Doorman / Security')">Doorman /
                                    Security</button>
                            </div>
                        </div>

                        <!-- Pet Logic -->
                        <div class="input-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="hasPets" id="hasPetsCheckbox"
                                    onchange="togglePetOptions()">
                                <span class="input-label" style="margin: 0;">Pets</span>
                            </label>

                            <div id="petOptions" style="display: none; margin-top: 15px; transition: all 0.3s ease;">
                                <div class="preference-grid" style="margin-bottom: 20px;">
                                    <div class="floating-label-group" style="margin-bottom: 0;">
                                        <input type="number" name="catCount" id="catCount" placeholder=" " min="0">
                                        <label for="catCount">Cats (Qty)</label>
                                    </div>
                                    <div class="floating-label-group" style="margin-bottom: 0;">
                                        <input type="number" name="dogCount" id="dogCount" placeholder=" " min="0"
                                            oninput="toggleDogDetails()">
                                        <label for="dogCount">Dogs (Qty)</label>
                                    </div>
                                </div>

                                <div id="dogOptions" style="display: none;">
                                    <div class="preference-grid">
                                        <div class="floating-label-group" style="margin-bottom: 0;">
                                            <input type="text" name="dogDetails" id="dogDetailsInput" placeholder=" ">
                                            <label for="dogDetailsInput">Dog Weight Approx</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn-submit"
                                style="background: transparent; color: var(--text-color); border: 1px solid var(--border-color); flex: 1;"
                                onclick="prevSection()">Back</button>
                            <button type="button" class="btn-submit" style="flex: 2;"
                                onclick="nextSection()">Continue</button>
                        </div>
                    </div>

                    <!-- SECTION 3: FINANCIAL & BACKGROUND -->
                    <div id="section-3" class="form-section">
                        <div style="margin-bottom: 30px;">
                            <span class="badge">STEP 03 OF 04</span>
                            <h2 style="margin-top: 10px; font-size: 24px;">Financial Information</h2>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Applying with Others</label>
                            <div class="button-group">
                                <input type="hidden" name="coapplicants" id="input-coapplicants" required>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-coapplicants', 'yes')">Yes</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-coapplicants', 'no')">No</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Evictions in Past 4 Years</label>
                            <div class="button-group">
                                <input type="hidden" name="evictions" id="input-evictions" required>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-evictions', 'yes')">Yes</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-evictions', 'no')">No</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Income 3x Monthly Rent</label>
                            <div class="button-group">
                                <input type="hidden" name="verifiableIncome" id="input-verifiableIncome" required>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-verifiableIncome', 'yes')">Yes</button>
                                <button type="button" class="option-btn"
                                    onclick="selectSingleOption(this, 'input-verifiableIncome', 'no')">No</button>
                            </div>
                        </div>

                        <div class="floating-label-group">
                            <select name="creditScore" id="creditScore"
                                onchange="this.dataset.hasValue = this.value ? 'true' : '';" required>
                                <option value="" selected disabled hidden></option>
                                <option value="excellent">Excellent (740+)</option>
                                <option value="great">Great (680-739)</option>
                                <option value="good">Good (620-679)</option>
                                <option value="fair">Fair (580-619)</option>
                                <option value="poor">Poor (&lt;580)</option>
                                <option value="unknown">Unknown</option>
                            </select>
                            <label for="creditScore">Credit Score</label>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn-submit"
                                style="background: transparent; color: var(--text-color); border: 1px solid var(--border-color); flex: 1;"
                                onclick="prevSection()">Back</button>
                            <button type="button" class="btn-submit" style="flex: 2;"
                                onclick="nextSection()">Continue</button>
                        </div>
                    </div>

                    <!-- SECTION 4: ADDITIONAL INFO -->
                    <div id="section-4" class="form-section">
                        <div style="margin-bottom: 30px;">
                            <span class="badge">STEP 04 OF 04</span>
                            <h2 style="margin-top: 10px; font-size: 24px;">Scheduling &amp; Notes</h2>
                        </div>

                        <div class="input-group">
                            <div style="margin-bottom: 15px;">
                                <label class="input-label">Available Days</label>
                                <div class="button-group">
                                    <input type="hidden" name="tourDays" id="input-tour-days" required>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Mon')">Mon</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Tue')">Tue</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Wed')">Wed</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Thu')">Thu</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Fri')">Fri</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Sat')">Sat</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-days', 'Sun')">Sun</button>
                                </div>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label class="input-label">Preferred Time of Day</label>
                                <div class="button-group">
                                    <input type="hidden" name="tourTimes" id="input-tour-times" required>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-times', 'Morning (9-12)')">Morning
                                        (9-12)</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-times', 'Afternoon (12-5)')">Afternoon
                                        (12-5)</button>
                                    <button type="button" class="option-btn"
                                        onclick="toggleOption(this, 'input-tour-times', 'Evening (5+)')">Evening
                                        (5+)</button>
                                </div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Additional Notes</label>
                            <textarea name="notes" placeholder="Is there anything else we should know?"></textarea>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn-submit"
                                style="background: transparent; color: var(--text-color); border: 1px solid var(--border-color); flex: 1;"
                                onclick="prevSection()">Back</button>
                            <button type="submit" class="btn-submit" style="flex: 2;">Submit</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <script>
        let currentSection = 1;
        const totalSections = 4;
        const completedSections = new Set();
        let devMode = false;

        function toggleDevMode() {
            devMode = document.getElementById('devModeToggle').checked;

            // If dev mode is enabled, unlock all sections
            if (devMode) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('disabled');
                });
            } else {
                // If dev mode is disabled, re-apply the locked state
                document.querySelectorAll('.nav-item').forEach((item, index) => {
                    const sectionNum = index + 1;
                    if (sectionNum > 1 && !completedSections.has(sectionNum - 1)) {
                        item.classList.add('disabled');
                    }
                });
            }
        }

        function switchSection(step) {
            const navItem = document.querySelector(`.nav-item[data-section="${step}"]`);

            // Prevent switching to disabled sections (unless dev mode is on)
            if (!devMode && navItem && navItem.classList.contains('disabled')) {
                return;
            }

            // Remove active from all sections and nav items
            document.querySelectorAll('.form-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
                // Restore completed class if this section was completed and not the current one
                const sectionNum = parseInt(el.getAttribute('data-section'));
                if (completedSections.has(sectionNum) && sectionNum !== step) {
                    el.classList.add('completed');
                }
            });

            // Activate current section
            document.getElementById(`section-${step}`).classList.add('active');
            if (navItem) {
                navItem.classList.add('active');
                // Remove completed class from active tab to show active state instead
                navItem.classList.remove('completed');
            }

            currentSection = step;
        }

        function unlockSection(sectionNumber) {
            const navItem = document.querySelector(`.nav-item[data-section="${sectionNumber}"]`);
            if (navItem) {
                navItem.classList.remove('disabled');
            }
        }

        function markSectionCompleted(sectionNumber) {
            completedSections.add(sectionNumber);
            const navItem = document.querySelector(`.nav-item[data-section="${sectionNumber}"]`);
            if (navItem) {
                navItem.classList.add('completed');
            }
        }

        function toggleOption(btn, inputId, value) {
            btn.classList.toggle('active');

            const input = document.getElementById(inputId);
            const parent = btn.parentElement;
            const activeBtns = parent.querySelectorAll('.option-btn.active');

            const selectedValues = Array.from(activeBtns).map(b => b.textContent.trim()).join(', ');
            input.value = selectedValues;

            // Remove error styling if valid
            if (selectedValues) input.style.borderColor = '';
        }

        function selectSingleOption(btn, inputId, value) {
            const parent = btn.parentElement;
            // Deselect all others
            parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));

            // Select clicked
            btn.classList.add('active');

            const input = document.getElementById(inputId);
            input.value = value;
            input.style.borderColor = '';
        }

        function nextSection() {
            if (currentSection < totalSections) {
                const section = document.getElementById(`section-${currentSection}`);
                let valid = true;
                let firstInvalidField = null;

                // Check text inputs, email, tel, date
                const textInputs = section.querySelectorAll('input[type="text"][required], input[type="email"][required], input[type="tel"][required], input[type="date"][required]');
                textInputs.forEach(input => {
                    if (!input.value.trim()) {
                        input.style.borderColor = 'red';
                        valid = false;
                        if (!firstInvalidField) firstInvalidField = input;
                    } else {
                        input.style.borderColor = '';
                    }
                });

                // Check select dropdowns
                const selects = section.querySelectorAll('select[required]');
                selects.forEach(select => {
                    if (!select.value || select.value === '') {
                        select.style.borderColor = 'red';
                        valid = false;
                        if (!firstInvalidField) firstInvalidField = select;
                    } else {
                        select.style.borderColor = '';
                    }
                });

                // Check checkboxes
                const checkboxes = section.querySelectorAll('input[type="checkbox"][required]');
                checkboxes.forEach(checkbox => {
                    if (!checkbox.checked) {
                        valid = false;
                        if (!firstInvalidField) firstInvalidField = checkbox;
                    }
                });

                // Check radio button groups
                const radioGroups = {};
                section.querySelectorAll('input[type="radio"][required]').forEach(radio => {
                    if (!radioGroups[radio.name]) {
                        radioGroups[radio.name] = [];
                    }
                    radioGroups[radio.name].push(radio);
                });

                for (const groupName in radioGroups) {
                    const radios = radioGroups[groupName];
                    const isChecked = radios.some(radio => radio.checked);
                    if (!isChecked) {
                        valid = false;
                        if (!firstInvalidField) firstInvalidField = radios[0];
                    }
                }

                // Check hidden inputs (button groups)
                const hiddenInputs = section.querySelectorAll('input[type="hidden"][required]');
                hiddenInputs.forEach(input => {
                    if (!input.value) {
                        valid = false;
                        if (!firstInvalidField) firstInvalidField = input;
                    }
                });

                if (!valid) {
                    alert('Please fill out all required fields before continuing.');
                    if (firstInvalidField) {
                        firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return;
                }

                // Mark current section as completed
                markSectionCompleted(currentSection);

                // Unlock next section
                if (currentSection + 1 <= totalSections) {
                    unlockSection(currentSection + 1);
                }

                switchSection(currentSection + 1);
            }
        }

        function prevSection() {
            if (currentSection > 1) {
                switchSection(currentSection - 1);
            }
        }

        function handleFinalSubmit(e) {
            e.preventDefault();

            // Validate section 4 fields before submitting
            const section = document.getElementById('section-4');
            let valid = true;
            let firstInvalidField = null;

            // Check hidden inputs (button groups for days and times)
            const hiddenInputs = section.querySelectorAll('input[type="hidden"][required]');
            hiddenInputs.forEach(input => {
                if (!input.value) {
                    valid = false;
                    if (!firstInvalidField) firstInvalidField = input;
                }
            });

            if (!valid) {
                alert('Please fill out all required fields before submitting.');
                if (firstInvalidField) {
                    firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }

            // Collect all form data
            const formData = new FormData(e.target);

            // Convert FormData to object for sending to Google Sheets
            const data = {
                timestamp: new Date().toISOString(),
                firstName: formData.get('firstName') || '',
                lastName: formData.get('lastName') || '',
                phone: formData.get('phone') || '',
                email: formData.get('email') || '',
                preferredContact: formData.get('preferredContact') || '',
                agent: document.getElementById('agentCheckbox').checked ? 'No agent' : '',
                propertyInterest: formData.get('propertyInterest') || '',
                bedrooms: formData.get('bedrooms') || '',
                neighborhoods: formData.get('neighborhoods') || '',
                moveInDate: formData.get('moveInDate') || '',
                budget: formData.get('budget') || '',
                nonNegotiables: formData.get('nonNegotiables') || '',
                hasPets: document.getElementById('hasPetsCheckbox').checked ? 'Yes' : 'No',
                catCount: formData.get('catCount') || '0',
                dogCount: formData.get('dogCount') || '0',
                dogDetails: formData.get('dogDetails') || '',
                coapplicants: formData.get('coapplicants') || '',
                evictions: formData.get('evictions') || '',
                verifiableIncome: formData.get('verifiableIncome') || '',
                creditScore: formData.get('creditScore') || '',
                tourDays: formData.get('tourDays') || '',
                tourTimes: formData.get('tourTimes') || '',
                notes: formData.get('notes') || ''
            };

            // Send to Google Sheets
            fetch('https://script.google.com/macros/s/AKfycbxEb-9KX_WQ6vOULT0aiOZt2PbSrI6qiSx65hmI5NDtuv4oDboV9lRzNJxa6g5RnLs23w/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                // Show overlay
                document.getElementById('submissionOverlay').classList.add('active');
            })
            .catch(error => {
                console.error('Error submitting form:', error);
                // Still show success overlay since no-cors mode prevents error detection
                document.getElementById('submissionOverlay').classList.add('active');
            });
        }

        function togglePetOptions() {
            const hasPets = document.getElementById('hasPetsCheckbox').checked;
            const petOptions = document.getElementById('petOptions');
            if (hasPets) {
                petOptions.style.display = 'block';
            } else {
                petOptions.style.display = 'none';

                // Clear values when hiding
                document.getElementById('catCount').value = '';
                document.getElementById('dogCount').value = '';
                document.getElementById('dogDetailsInput').value = '';
                toggleDogDetails();
            }
        }

        function toggleDogDetails() {
            const dogCount = document.getElementById('dogCount').value;
            const dogOptions = document.getElementById('dogOptions');

            // Show details if dog count is > 0
            if (dogCount && parseInt(dogCount) > 0) {
                dogOptions.style.display = 'block';
                // Make required if visible
                document.getElementById('dogDetailsInput').setAttribute('required', 'required');
            } else {
                dogOptions.style.display = 'none';
                document.getElementById('dogDetailsInput').removeAttribute('required');
            }
        }
    </script>
    <style>
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .preference-grid {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 100%;
        }

        /* Default Button Style (Restored) */
        .option-btn {
            padding: 8px 12px;
            background: #f0f0f0;
            border: 1px solid transparent;
            border-radius: 0px;
            /* Enforcing sharp edges per TE style */
            font-size: 12px;
            font-weight: 600;
            color: var(--muted-color);
            cursor: pointer;
            transition: all 0.2s;
            text-transform: none;
        }

        /* Specific Sizing ONLY for Property Preferences */
        .preference-grid .option-btn {
            padding: 10px 8px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.25;
            min-height: 44px;
            height: 100%;
            width: 100%;
        }

        .option-btn:hover {
            background: #e0e0e0;
            color: var(--text-color);
        }

        .option-btn.active {
            background: var(--text-color);
            color: var(--bg-color);
            border-color: var(--text-color);
        }

        /* Make Yes/No buttons equal width */
        .button-group .option-btn {
            min-width: 80px;
        }

        .preference-grid .option-btn {
            min-width: 0;
            /* Let grid handle width */
            width: 100%;
        }

        /* Center labels vertically inside preference grid inputs */
        .preference-grid .floating-label-group label {
            top: 50%;
            transform: translateY(-50%);
            left: 12px;
            /* Keep left alignment */
            width: auto;
            text-align: left;
        }

        /* Float label when focused or has value */
        .preference-grid .floating-label-group input:focus+label,
        .preference-grid .floating-label-group input:not(:placeholder-shown)+label,
        .preference-grid .floating-label-group select:focus+label,
        .preference-grid .floating-label-group select[data-has-value="true"]+label {
            top: 4px;
            transform: none;
        }

        @media (max-width: 600px) {
            .preference-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            h2 {
                font-size: 20px !important;
            }

            .badge {
                font-size: 11px;
            }
        }

        /* Very small screens */
        @media (max-width: 360px) {
            .form-panel {
                padding: 15px;
            }
        }
    </style>
    <!-- Submission Overlay -->
    <div id="submissionOverlay" class="submission-overlay">
        <div class="submission-content">
            <div class="success-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <h2 class="submission-title">Youâ€™re all set</h2>
            <p class="submission-message">Thanks for reaching out to Key Legacy Realty.<br>Our team will be in touch
                shortly.</p>
            <button class="btn-submit" onclick="location.reload()" style="max-width: 200px; margin: 0 auto;">Back to
                Home</button>
        </div>
    </div>
</body>

</html>